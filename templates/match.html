<!DOCTYPE html>
<html>

<head>
    <link rel="stylesheet" href="{{ url_for('static',filename='assets/styles/index.css') }}" type="text/css">
</head>

<body>
        <div id="line-up-container">
            <table class="line-up-text" id="home">
                    <tr>
                        {% for player in matchData[0]['lineup'] %}
                            <tr id={{loop.index}}>
                                <td onmouseover="togglePosition({{loop.index}})" onmouseleave="togglePosition({{loop.index}})">{{player['player']['name']}}</td>
                                <td onmouseover="togglePosition({{loop.index}})" onmouseleave="togglePosition({{loop.index}})">{{player['jersey_number']}}</td>
                            </tr>
                        {% endfor %}
                    </tr>
                </table>
                {{lineup}}
                <table class="line-up-text" id="away">
                    <tr>
                        {% for player in matchData[1]['lineup'] %}
                            <tr>
                                <td onmouseover="togglePosition({{loop.index + 11}})" onmouseleave="togglePosition({{loop.index + 11}})">{{player['jersey_number']}}</td>
                                <td onmouseover="togglePosition({{loop.index + 11}})" onmouseleave="togglePosition({{loop.index + 11}})">{{player['player']['name']}}</td>
                            </tr>
                        {% endfor %}
                    </tr>
                </table>
        </div>

        <div id="shots-container">
            <div class="shots-plot" id="home-plot">
                {{home_plot}}
            </div>
            <table id="shots-text">
                <tr>
                    <td id="left">{{statistics['home']['name']}}</td>
                    <td id="center">{{statistics['home']['goals']}} - {{statistics['away']['goals']}}</td>
                    <td id="right">{{statistics['away']['name']}}</td>
                </tr>
                <tr>
                    <td id="left">{{statistics['home']['xG']}}</td>
                    <td id="center">Expected goals</td>
                    <td id="right">{{statistics['away']['xG']}}</td>
                </tr>
                <tr>
                    <td id="left">{{statistics['home']['attempts']['total']}}</td>
                    <td id="center">Total attempts</td>
                    <td id="right">{{statistics['away']['attempts']['total']}}</td>
                </tr>
                <tr>
                    <td id="left" onmouseenter="toggleOnTarget('home', 'on_target')", onmouseleave="toggleOnTarget()">{{statistics['home']['attempts']['on_target']}}</td>
                    <td id="center" onmouseenter="toggleOnTarget('both', 'on_target')", onmouseleave="toggleOnTarget()">On target</td>
                    <td id="right" onmouseenter="toggleOnTarget('away', 'on_target')", onmouseleave="toggleOnTarget()">{{statistics['away']['attempts']['on_target']}}</td>
                </tr>
                <tr>
                    <td id="left" onmouseenter="toggleOnTarget('home', 'blocked')", onmouseleave="toggleOnTarget()">{{statistics['home']['attempts']['blocked']}}</td>
                    <td id="center" onmouseenter="toggleOnTarget('both', 'blocked')", onmouseleave="toggleOnTarget()">Blocked</td>
                    <td id="right" onmouseenter="toggleOnTarget('away', 'blocked')", onmouseleave="toggleOnTarget()">{{statistics['away']['attempts']['blocked']}}</td>
                </tr>
            </table>
            <div class="shots-plot" id="away-plot">
                {{away_plot}}
            </div>
        </div>

<script>

                const statistics = {
                    'home': {
                        'goals': {{statistics['home']['goals'] | safe}},
                        'attempts': {{statistics['home']['attempts'] | safe}},
                    },
                    'away': {
                        'goals': {{statistics['away']['goals'] | safe}},
                        'attempts': {{statistics['away']['attempts'] | safe}},
                    }
                }

                function togglePosition(index){
                   document.getElementById("text_" + index).firstElementChild.firstElementChild.classList.toggle('highlight');
                }

                function toggleOnTarget(side = 'leave', event = null){
                    if(side === 'leave'){
                        paths = document.querySelectorAll('[id*="PathCollection_"]');
                        paths.forEach((path) => {
                            path.classList.remove('none');
                        })
                    }
                    else if(side === 'both'){
                        toggleOnTarget('home', event);
                        toggleOnTarget('away', event);
                    }
                    else{
                        const goals = statistics[side]['goals']
                        const shots = statistics[side]['attempts']['total'];
                        const onTarget = statistics[side]['attempts']['on_target'];
                        const blocked = statistics[side]['attempts']['blocked'];

                        const indices = {
                            'goal': [shots, shots - goals],
                            'on_target': [shots - goals, shots - goals - onTarget],
                            'blocked': [shots - goals - onTarget, shots - goals - onTarget - blocked]
                        }


                        const plot = document.getElementById(side + '-plot');
                        for(let i = 1; i <= shots; i++){
                            if(i <= indices[event][1] || i > indices[event][0]){
                                plot.querySelector("#PathCollection_" + i).classList.toggle('none');
                            }
                        }
                    }
                }
            </script>

</body>
</html>